MAT1 EQU 20h
MAT2 EQU 28h
ADJCOUNT EQU 38h

INIT:
	MOV	20h, #01000100b
	MOV	21h, #00000010b
	MOV	22h, #00110010b
	MOV	23h, #10000000b
	MOV	24h, #01101010b
	MOV	25h, #00000010b
	MOV	26h, #00000000b
	MOV	27h, #01100010b

START:
    ACALL COPY
    ACALL STEP

STOP:
    AJMP STOP

COPY:
    ACALL CALCBASEADDRESS
    MOV R0, A
    CPL F0
    ACALL CALCBASEADDRESS
    MOV R1, A
    MOV A, @R0
    MOV @R1, A
    INC R0
    INC R1
    MOV A, @R0
    MOV @R1, A
    INC R0
    INC R1
    MOV A, @R0
    MOV @R1, A
    INC R0
    INC R1
    MOV A, @R0
    MOV @R1, A
    INC R0
    INC R1
    MOV A, @R0
    MOV @R1, A
    INC R0
    INC R1
    MOV A, @R0
    MOV @R1, A
    INC R0
    INC R1
    MOV A, @R0
    MOV @R1, A
    INC R0
    INC R1
    MOV A, @R0
    MOV @R1, A
    RET

STEP:
    MOV A, #64
    MOV R0, #ADJCOUNT
CLEARADJ:
    MOV @R0, #00h
    DEC A
    INC R0
    JNZ CLEARADJ

    MOV R2, #64
    MOV R0, #ADJCOUNT
STEPLOOP:
    MOV A, R0
    SUBB A, #ADJCOUNT
    ANL A, #00000111b
    JZ STEP01
    DEC R0
    INC @R0
    INC R0
STEP01:
    MOV A, R0
    SUBB A, #08h
    MOV B, R0
    MOV R0, A
    INC @R0
    MOV R0, B
STEP02:
    MOV A, R0
    SUBB A, #ADJCOUNT
    ANL A, #00000111b
    INC A
    ANL A, #00000111b
    JZ STEP03
    INC R0
    INC @R0
    DEC R0
STEP03:
    MOV A, R0
    ADD A, #08h
    MOV B, R0
    MOV R0, A
    INC @R0
    MOV R0, B
STEPEND:
    DEC R2
    INC R0
    MOV A, R2
    JNZ STEPLOOP
STEPRET:
    RET

CALCBASEADDRESS:
    MOV A, #MAT2
    JB F0, CALCBASEADDRESS1
    MOV A, #MAT1
CALCBASEADDRESS1:
    RET

END